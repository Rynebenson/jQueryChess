<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <title>Chess</title>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
        <link rel="stylesheet" type="text/css" href="index.css">
    </head>
    <body>
        <div id="chessboard"></div>

        <script>
            let gameplay = {
                status: 'ingame',
                player_turn: 'white'
            }

            const pieces = {

                b_pawn_1: {
                    entity: '&#9823;',
                    image: `<img class="piece_image" src="./images/black_pawn.png" alt="" />`,
                    type: 'pawn',
                    move: 0
                },
                b_pawn_2: {
                    entity: '&#9823;',
                    image: `<img class="piece_image" src="./images/black_pawn.png" alt="" />`,
                    type: 'pawn',
                    move: 0
                },
                b_pawn_3: {
                    entity: '&#9823;',
                    image: `<img class="piece_image" src="./images/black_pawn.png" alt="" />`,
                    type: 'pawn',
                    move: 0
                },
                b_pawn_4: {
                    entity: '&#9823;',
                    image: `<img class="piece_image" src="./images/black_pawn.png" alt="" />`,
                    type: 'pawn',
                    move: 0
                },
                b_pawn_5: {
                    entity: '&#9823;',
                    image: `<img class="piece_image" src="./images/black_pawn.png" alt="" />`,
                    type: 'pawn',
                    move: 0
                },
                b_pawn_6: {
                    entity: '&#9823;',
                    image: `<img class="piece_image" src="./images/black_pawn.png" alt="" />`,
                    type: 'pawn',
                    move: 0
                },
                b_pawn_7: {
                    entity: '&#9823;',
                    image: `<img class="piece_image" src="./images/black_pawn.png" alt="" />`,
                    type: 'pawn',
                    move: 0
                },
                b_pawn_8: {
                    entity: '&#9823;',
                    image: `<img class="piece_image" src="./images/black_pawn.png" alt="" />`,
                    type: 'pawn',
                    move: 0
                },
                b_rook_1: {
                    entity: '&#9820;',
                    image: `<img class="piece_image" src="./images/black_rook.png" alt="" />`,
                    type: 'rook',
                    move: 0
                },
                b_rook_2: {
                    entity: '&#9820;',
                    image: `<img class="piece_image" src="./images/black_rook.png" alt="" />`,
                    type: 'rook',
                    move: 0
                },
                b_bishop_1: {
                    entity: '&#9821;',
                    image: `<img class="piece_image" src="./images/black_bishop.png" alt="" />`,
                    type: 'bishop',
                    move: 0
                },
                b_bishop_2: {
                    entity: '&#9821;',
                    image: `<img class="piece_image" src="./images/black_bishop.png" alt="" />`,
                    type: 'bishop',
                    move: 0
                },
                b_knight_1: {
                    entity: '&#9822;',
                    image: `<img class="piece_image" src="./images/black_knight.png" alt="" />`,
                    type: 'knight',
                    move: 0
                },
                b_knight_2: {
                    entity: '&#9822;',
                    image: `<img class="piece_image" src="./images/black_knight.png" alt="" />`,
                    type: 'knight',
                    move: 0
                },
                b_queen: {
                    entity: '&#9819;',
                    image: `<img class="piece_image" src="./images/black_queen.png" alt="" />`,
                    type: 'queen',
                    move: 0
                },
                b_king: {
                    entity: '&#9818;',
                    image: `<img class="piece_image" src="./images/black_king.png" alt="" />`,
                    type: 'king',
                    move: 0
                },
                w_pawn_1: {
                    entity: '&#9817;',
                    image: `<img class="piece_image" src="./images/white_pawn.png" alt="" />`,
                    type: 'pawn',
                    move: 0
                },
                w_pawn_2: {
                    entity: '&#9817;',
                    image: `<img class="piece_image" src="./images/white_pawn.png" alt="" />`,
                    type: 'pawn',
                    move: 0
                },
                w_pawn_3: {
                    entity: '&#9817;',
                    image: `<img class="piece_image" src="./images/white_pawn.png" alt="" />`,
                    type: 'pawn',
                    move: 0
                },
                w_pawn_4: {
                    entity: '&#9817;',
                    image: `<img class="piece_image" src="./images/white_pawn.png" alt="" />`,
                    type: 'pawn',
                    move: 0
                },
                w_pawn_5: {
                    entity: '&#9817;',
                    image: `<img class="piece_image" src="./images/white_pawn.png" alt="" />`,
                    type: 'pawn',
                    move: 0
                },
                w_pawn_6: {
                    entity: '&#9817;',
                    image: `<img class="piece_image" src="./images/white_pawn.png" alt="" />`,
                    type: 'pawn',
                    move: 0
                },
                w_pawn_7: {
                    entity: '&#9817;',
                    image: `<img class="piece_image" src="./images/white_pawn.png" alt="" />`,
                    type: 'pawn',
                    move: 0
                },
                w_pawn_8: {
                    entity: '&#9817;',
                    image: `<img class="piece_image" src="./images/white_pawn.png" alt="" />`,
                    type: 'pawn',
                    move: 0
                },
                w_rook_1: {
                    entity: '&#9814;',
                    image: `<img class="piece_image" src="./images/white_rook.png" alt="" />`,
                    type: 'rook',
                    move: 0
                },
                w_rook_2: {
                    entity: '&#9814;',
                    image: `<img class="piece_image" src="./images/white_rook.png" alt="" />`,
                    type: 'rook',
                    move: 0
                },
                w_bishop_1: {
                    entity: '&#9815;',
                    image: `<img class="piece_image" src="./images/white_bishop.png" alt="" />`,
                    type: 'bishop',
                    move: 0
                },
                w_bishop_2: {
                    entity: '&#9815;',
                    image: `<img class="piece_image" src="./images/white_bishop.png" alt="" />`,
                    type: 'bishop',
                    move: 0
                },
                w_knight_1: {
                    entity: '&#9816;',
                    image: `<img class="piece_image" src="./images/white_knight.png" alt="" />`,
                    type: 'knight',
                    move: 0
                },
                w_knight_2: {
                    entity: '&#9816;',
                    image: `<img class="piece_image" src="./images/white_knight.png" alt="" />`,
                    type: 'knight',
                    move: 0
                },
                w_queen: {
                    entity: '&#9813;',
                    image: `<img class="piece_image" src="./images/white_queen.png" alt="" />`,
                    type: 'queen',
                    move: 0
                },
                w_king: {
                    entity: '&#9812;',
                    image: `<img class="piece_image" src="./images/white_king.png" alt="" />`,
                    type: 'king',
                    move: 0
                },
            }

            const nextCol = {
                'A': 'B',
                'B': 'C',
                'C': 'D',
                'D': 'E',
                'E': 'F',
                'F': 'G',
                'G': 'H'
            };

            const prevCol = {
                'H': 'G',
                'G': 'F',
                'F': 'E',
                'E': 'D',
                'D': 'C',
                'C': 'B',
                'B': 'A'
            };

            const letterToNum = {
                'A': 1,
                'B': 2,
                'C': 3,
                'D': 4,
                'E': 5,
                'F': 6,
                'G': 7,
                'H': 8
            }

            const numToLetter = {
                1: 'A',
                2: 'B',
                3: 'C',
                4: 'D',
                5: 'E',
                6: 'F',
                7: 'G',
                8: 'H'
            }
            
            function load_board() {

	            rows = ["A", "B", "C", "D", "E", "F", "G", "H"];
	            cols = [1, 2, 3, 4, 5, 6, 7, 8];

  	            var count = 0;

                for(var i = 0; i < rows.length; i++) {
                    for (var j = 0; j < cols.length; j++) {

                        // after every 8th tile start new line w css- clear: left 
                        if(count % 8 == 0) {
                            $("#chessboard").append('<div class="tile" style="clear:left"></div>');
                        } else{
                            $("#chessboard").append('<div class="tile"></div>');
                        }

                        // assign position to each tile
                        $(".tile").eq(count).attr("data-position", ((rows[rows.length - (i +1)] + cols[j])));
                        
                        // add background for every other tile
                        if(((i % 2 == 0) && (j % 2 != 0)) || ((i % 2 != 0) && (j % 2 == 0))) {
                            $(".tile").eq(count).addClass("black");
                        } else {
                            $(".tile").eq(count).addClass("white");
                        }

                        count++;
                    }
                }
            }

            function load_pieces() {

                var tiles = document.getElementsByClassName('tile')

                for(var i = 0; i < tiles.length; i++) {

                    const tile_position = $(tiles[i]).data().position;
                    
                    switch(tile_position) {
                        case 'H1':
                            $('.tile[data-position=H1]').append(`<span class="piece" data-move="${ pieces.b_rook_1.move }" data-team="black" data-type="${pieces.b_rook_1.type}">${ pieces.b_rook_1.image }</span>`);
                        case 'H2':
                            $('.tile[data-position=H2]').append(`<span class="piece" data-move="${ pieces.b_knight_1.move }" data-team="black" data-type="${pieces.b_knight_1.type}">${ pieces.b_knight_1.image }</span>`);
                        case 'H3':
                            $('.tile[data-position=H3]').append(`<span class="piece" data-move="${ pieces.b_bishop_1.move }" data-team="black" data-type="${pieces.b_bishop_1.type}">${ pieces.b_bishop_1.image }</span>`);
                        case 'H4':
                            $('.tile[data-position=H4]').append(`<span class="piece" data-move="${ pieces.b_queen.move }" data-team="black" data-type="${pieces.b_queen.type}">${ pieces.b_queen.image }</span>`);
                        case 'H5':
                            $('.tile[data-position=H5]').append(`<span class="piece" data-move="${ pieces.b_king.move }" data-team="black" data-type="${pieces.b_king.type}">${ pieces.b_king.image }</span>`);
                        case 'H6':
                            $('.tile[data-position=H6]').append(`<span class="piece" data-move="${ pieces.b_bishop_2.move }" data-team="black" data-type="${pieces.b_bishop_2.type}">${ pieces.b_bishop_2.image }</span>`);
                        case 'H7':
                            $('.tile[data-position=H7]').append(`<span class="piece" data-move="${ pieces.b_knight_2.move }" data-team="black" data-type="${pieces.b_knight_2.type}">${ pieces.b_knight_2.image }</span>`);
                        case 'H8':
                            $('.tile[data-position=H8]').append(`<span class="piece" data-move="${ pieces.b_rook_2.move }" data-team="black" data-type="${pieces.b_rook_2.type}">${ pieces.b_rook_2.image }</span>`);
                        case 'G1':
                            $('.tile[data-position=G1]').append(`<span class="piece" data-move="${ pieces.b_pawn_1.move }" data-team="black" data-type="${pieces.b_pawn_1.type}">${ pieces.b_pawn_1.image }</span>`);
                        case 'G2':
                            $('.tile[data-position=G2]').append(`<span class="piece" data-move="${ pieces.b_pawn_2.move }" data-team="black" data-type="${pieces.b_pawn_2.type}">${ pieces.b_pawn_2.image }</span>`);
                        case 'G3':
                            $('.tile[data-position=G3]').append(`<span class="piece" data-move="${ pieces.b_pawn_3.move }" data-team="black" data-type="${pieces.b_pawn_3.type}">${ pieces.b_pawn_3.image }</span>`);
                        case 'G4':
                            $('.tile[data-position=G4]').append(`<span class="piece" data-move="${ pieces.b_pawn_4.move }" data-team="black" data-type="${pieces.b_pawn_4.type}">${ pieces.b_pawn_4.image }</span>`);
                        case 'G5':
                            $('.tile[data-position=G5]').append(`<span class="piece" data-move="${ pieces.b_pawn_5.move }" data-team="black" data-type="${pieces.b_pawn_5.type}">${ pieces.b_pawn_5.image }</span>`);
                        case 'G6':
                            $('.tile[data-position=G6]').append(`<span class="piece" data-move="${ pieces.b_pawn_6.move }" data-team="black" data-type="${pieces.b_pawn_6.type}">${ pieces.b_pawn_6.image }</span>`);
                        case 'G7':
                            $('.tile[data-position=G7]').append(`<span class="piece" data-move="${ pieces.b_pawn_7.move }" data-team="black" data-type="${pieces.b_pawn_7.type}">${ pieces.b_pawn_7.image }</span>`);
                        case 'G8':
                            $('.tile[data-position=G8]').append(`<span class="piece" data-move="${ pieces.b_pawn_8.move }" data-team="black" data-type="${pieces.b_pawn_8.type}">${ pieces.b_pawn_8.image }</span>`);
                        case 'B1':
                            $('.tile[data-position=B1]').append(`<span class="piece" data-move="${ pieces.w_pawn_1.move }" data-team="white" data-type="${pieces.w_pawn_1.type}">${ pieces.w_pawn_1.image }</span>`);
                        case 'B2':
                            $('.tile[data-position=B2]').append(`<span class="piece" data-move="${ pieces.w_pawn_2.move }" data-team="white" data-type="${pieces.w_pawn_2.type}">${ pieces.w_pawn_2.image }</span>`);
                        case 'B3':
                            $('.tile[data-position=B3]').append(`<span class="piece" data-move="${ pieces.w_pawn_3.move }" data-team="white" data-type="${pieces.w_pawn_3.type}">${ pieces.w_pawn_3.image }</span>`);
                        case 'B4':
                            $('.tile[data-position=B4]').append(`<span class="piece" data-move="${ pieces.w_pawn_4.move }" data-team="white" data-type="${pieces.w_pawn_4.type}">${ pieces.w_pawn_4.image }</span>`);
                        case 'B5':
                            $('.tile[data-position=B5]').append(`<span class="piece" data-move="${ pieces.w_pawn_5.move }" data-team="white" data-type="${pieces.w_pawn_5.type}">${ pieces.w_pawn_5.image }</span>`);
                        case 'B6':
                            $('.tile[data-position=B6]').append(`<span class="piece" data-move="${ pieces.w_pawn_6.move }" data-team="white" data-type="${pieces.w_pawn_6.type}">${ pieces.w_pawn_6.image }</span>`);
                        case 'B7':
                            $('.tile[data-position=B7]').append(`<span class="piece" data-move="${ pieces.w_pawn_7.move }" data-team="white" data-type="${pieces.w_pawn_7.type}">${ pieces.w_pawn_7.image }</span>`);
                        case 'B8':
                            $('.tile[data-position=B8]').append(`<span class="piece" data-move="${ pieces.w_pawn_8.move }" data-team="white" data-type="${pieces.w_pawn_8.type}">${ pieces.w_pawn_8.image }</span>`);
                        case 'A1':
                            $('.tile[data-position=A1]').append(`<span class="piece" data-move="${ pieces.w_rook_1.move }" data-team="white" data-type="${pieces.w_rook_1.type}">${ pieces.w_rook_1.image }</span>`);
                        case 'A2':
                            $('.tile[data-position=A2]').append(`<span class="piece" data-move="${ pieces.w_knight_1.move }" data-team="white" data-type="${pieces.w_knight_1.type}">${ pieces.w_knight_1.image }</span>`);
                        case 'A3':
                            $('.tile[data-position=A3]').append(`<span class="piece" data-move="${ pieces.w_bishop_1.move }" data-team="white" data-type="${pieces.w_bishop_1.type}">${ pieces.w_bishop_1.image }</span>`);
                        case 'A4':
                            $('.tile[data-position=A4]').append(`<span class="piece" data-move="${ pieces.w_queen.move }" data-team="white" data-type="${pieces.w_queen.type}">${ pieces.w_queen.image }</span>`);
                        case 'A5':
                            $('.tile[data-position=A5]').append(`<span class="piece" data-move="${ pieces.w_king.move }" data-team="white" data-type="${pieces.w_king.type}">${ pieces.w_king.image }</span>`);
                        case 'A6':
                            $('.tile[data-position=A6]').append(`<span class="piece" data-move="${ pieces.w_bishop_2.move }" data-team="white" data-type="${pieces.w_bishop_2.type}">${ pieces.w_bishop_2.image }</span>`);
                        case 'A7':
                            $('.tile[data-position=A7]').append(`<span class="piece" data-move="${ pieces.w_knight_2.move }" data-team="white" data-type="${pieces.w_knight_2.type}">${ pieces.w_knight_2.image }</span>`);
                        case 'A8':
                            $('.tile[data-position=A8]').append(`<span class="piece" data-move="${ pieces.w_rook_2.move }" data-team="white" data-type="${pieces.w_rook_2.type}">${ pieces.w_rook_2.image }</span>`);
                        default:
                            return null
                    }
                }
            }

            function highlight_potential_moves(potential_destinations) {
                for(var i = 0; i < potential_destinations.length; i++) {
                    $(`.tile[data-position=${ potential_destinations[i] }]`).addClass(' potential_destination');
                }
            }

            function evaluate_potential_moves(position, type, team, move) {

                let potential_destinations = [];
                let piece_column = position.charAt(0);
                let piece_row = position.charAt(1);
                let current_column = piece_column;
                let increment_row = piece_row;
                let decrement_row = piece_row;

                switch(type) {
                    case "pawn":
                        // push positions for one move forward & backward
                        potential_destinations.push(nextCol[piece_column] + piece_row);
                        potential_destinations.push(prevCol[piece_column] + piece_row);

                        if(move == 0) {
                            // push positions for two moves forward & backward if it's first move
                            potential_destinations.push(nextCol[nextCol[piece_column]] + piece_row);
                            potential_destinations.push(prevCol[prevCol[piece_column]] + piece_row);
                        }

                        // push positions for diagonal moves
                        potential_destinations.push(nextCol[piece_column] + ((1 * piece_row) + 1));
                        potential_destinations.push(nextCol[piece_column] + ((1 * piece_row) - 1));
                        potential_destinations.push(prevCol[piece_column] + ((1 * piece_row) + 1));
                        potential_destinations.push(prevCol[piece_column] + ((1 * piece_row) - 1));

                        break;
                    case "rook":
                        // push positions for forward and backwards moves
                        for(const key in nextCol) {
                            potential_destinations.push(key + piece_row);
                        }
                        potential_destinations.push(`H${ piece_row }`);

                        // push positions for left and right moves
                        for(var i = 1; i < 9; i++) {
                            potential_destinations.push(piece_column + i);
                        }

                        break;
                    case "knight":
                        // forward/backward two & left/right one
                        potential_destinations.push(nextCol[nextCol[piece_column]] + ((1 * piece_row) - 1));
                        potential_destinations.push(nextCol[nextCol[piece_column]] + ((1 * piece_row) + 1));
                        potential_destinations.push(prevCol[prevCol[piece_column]] + ((1 * piece_row) - 1));
                        potential_destinations.push(prevCol[prevCol[piece_column]] + ((1 * piece_row) + 1));

                        // left/right two & forward/backward one
                        potential_destinations.push(nextCol[piece_column] + ((1 * piece_row) + 2));
                        potential_destinations.push(nextCol[piece_column] + ((1 * piece_row) - 2));
                        potential_destinations.push(prevCol[piece_column] + ((1 * piece_row) + 2));
                        potential_destinations.push(prevCol[piece_column] + ((1 * piece_row) - 2));

                        break;
                    case "bishop":
                        // backwards through columns
                        while(current_column !== 'A') {
                            current_column = prevCol[current_column];

                            if(increment_row < 8) {
                                potential_destinations.push(current_column + (++increment_row));
                            }

                            if(decrement_row > 1) {
                                potential_destinations.push(current_column + (--decrement_row));
                            }
                        }

                        current_column = piece_column;
                        increment_row = piece_row;
                        decrement_row = piece_row;

                        // forwards through columns
                        while(current_column !== 'H') {
                            current_column = nextCol[current_column];

                            if(increment_row < 8) {
                                potential_destinations.push(current_column + (++increment_row));
                            }

                            if(decrement_row > 1) {
                                potential_destinations.push(current_column + (--decrement_row));
                            }
                        }

                        break;
                    case "queen":
                        // moves like rook
                        for(const key in nextCol) {
                            potential_destinations.push(key + piece_row);
                        }
                        potential_destinations.push(`H${ piece_row }`);

                        // push positions for left and right moves
                        for(var i = 1; i < 9; i++) {
                            potential_destinations.push(piece_column + i);
                        }

                        // also moves like bishop

                        while(current_column !== 'A') {
                            current_column = prevCol[current_column];

                            if(increment_row < 8) {
                                potential_destinations.push(current_column + (++increment_row));
                            }

                            if(decrement_row > 1) {
                                potential_destinations.push(current_column + (--decrement_row));
                            }
                        }

                        current_column = piece_column;
                        increment_row = piece_row;
                        decrement_row = piece_row;

                        // forwards through columns
                        while(current_column !== 'H') {
                            current_column = nextCol[current_column];

                            if(increment_row < 8) {
                                potential_destinations.push(current_column + (++increment_row));
                            }

                            if(decrement_row > 1) {
                                potential_destinations.push(current_column + (--decrement_row));
                            }
                        }

                        break;
                    case 'king':
                        // move one space in any direction
                        potential_destinations.push(piece_column + ((1 * piece_row) + 1));
                        potential_destinations.push(piece_column + ((1 * piece_row) - 1));
                        potential_destinations.push(nextCol[piece_column] + piece_row);
                        potential_destinations.push(prevCol[piece_column] + piece_row);
                        potential_destinations.push(nextCol[piece_column] + ((1 * piece_row) + 1));
                        potential_destinations.push(nextCol[piece_column] + ((1 * piece_row) - 1));
                        potential_destinations.push(prevCol[piece_column] + ((1 * piece_row) + 1));
                        potential_destinations.push(prevCol[piece_column] + ((1 * piece_row) - 1));

                        break;
                }

                return potential_destinations
            }

            function path_is_open(position, destination) {
                let col = position.charAt(0);
                let row = position.charAt(1);
                let destination_col = destination.charAt(0);
                let destination_row = destination.charAt(1);
                let currCol = col;
                let currRow = row;

                if(col !== destination_col && row !== destination_row) { // if path is diagonal
                    if(row < destination_row) { // left to right
                        if(letterToNum[col] < letterToNum[destination_col]) { // bottom to top
                            currCol = nextCol[currCol];

                            for(currRow = ((1 * row) + 1); currRow <= destination_row; currRow++) {
                                var current_element = $(`.tile[data-position=${ currCol + currRow }`)[0];

                                if($(current_element).children().length > 0) {
                                    return false
                                }

                                currCol = nextCol[currCol];
                            }
                        } else { // top to bottom
                            currCol = prevCol[currCol];

                            for(currRow = ((1 * row) + 1); currRow <= destination_row; currRow++) {
                                var current_element = $(`.tile[data-position=${ currCol + currRow }`)[0];

                                if($(current_element).children().length > 0) {
                                    return false
                                }

                                currCol = prevCol[prevCol];
                            }
                        }
                    } else { // right to left
                        if(letterToNum[col] < letterToNum[destination_col]) { // bottom to top
                            currCol = nextCol[currCol];

                            for(currRow = (row - 1); currRow >= destination_row; currRow--) {
                                var current_element = $(`.tile[data-position=${ currCol + currRow }`)[0];

                                if($(current_element).children().length > 0) {
                                    return false
                                }

                                currCol = nextCol[currCol];
                            }
                        } else { // top to bottom
                            currCol = prevCol[currCol];

                            for(currRow = (row - 1); currRow >= destination_row; currRow--) {
                                var current_element = $(`.tile[data-position=${ currCol + currRow }`)[0];

                                if($(current_element).children().length > 0) {
                                    return false
                                }

                                currCol = prevCol[currCol];
                            }
                        }
                    }
                } else if(col === destination_col){ // if path is horizontal
                    if(row < destination_row) { // traverse right
                        for(var i = ((1 * row) + 1); i <= destination_row; i++) {
                            var current_element = $(`.tile[data-position=${col + i}]`)[0];
                            if($(current_element).children().length > 0) {
                                return false
                            }
                        }
                    } else { // traverse left
                        for(var i = (row - 1); i >= destination_row; i--) {
                            var current_element = $(`.tile[data-position=${col + i}]`)[0];
                            if($(current_element).children().length > 0) {
                                return false;
                            }
                        }
                    }
                } else { // if path is vertical
                    if(letterToNum[col] < letterToNum[destination_col]) { // traverse up
                        for(var i = (letterToNum[col] + 1); i <= letterToNum[destination_col]; i++) {
                            var current_element = $(`.tile[data-position=${numToLetter[i] + row}]`)[0];
                            if($(current_element).children().length > 0) {
                                return false;
                            }
                        }
                    } else { // traverse down
                        for(var i = (letterToNum[col] - 1); i >= letterToNum[destination_col]; i--) {
                            var current_element = $(`.tile[data-position=${numToLetter[i] + row}]`)[0];
                            if($(current_element).children().length > 0) {
                                return false;
                            }
                        }
                    }
                }

                return true;
            }

            function valid_location(position) {
                let col = position.charAt(0);
                let row = position.substring(1, position.length);

                if(row > 8 || row < 1) {
                    return false;
                }

                switch(col) {
                    case 'A':
                    case 'B':
                    case 'C':
                    case 'D':
                    case 'E':
                    case 'F':
                    case 'G':
                    case 'H':
                        return true;
                    default:
                        return false;
                }
            }

            function evaluate_valid_moves(position, type, team, move) {
                let valid_moves = evaluate_potential_moves(position, type, team, move).filter(Boolean);

                for(var i = 0; i < valid_moves.length; i++) {
                    let destination = valid_moves[i];

                    // if location is not valid, remove
                    if(!valid_location(destination)) {
                        delete valid_moves[i];
                    }

                    // if location has a piece from your team within, remove
                    if($(`.tile[data-position=${ destination }]`).children().length > 0) {
                        const destination_team = $(`.tile[data-position=${destination}]`).children('span').data().team;
                        
                        if(team === destination_team) {
                            delete valid_moves[i];
                        }
                    }

                    if(type === "pawn") {
                        let col = position.charAt(0);
                        let row = position.charAt(1);
                        let destination_col = destination.charAt(0);
                        let destination_row = destination.charAt(1);

                        // if destination is behind pawn, remove
                        if(team === "black") {
                            if(letterToNum[destination_col] > letterToNum[col]) {
                                delete valid_moves[i];
                            }
                        } else {
                            if(letterToNum[destination_col] < letterToNum[col]) {
                                delete valid_moves[i];
                            }
                        }

                        // if move is diagonal, remove unless opponent is there
                        if(destination_row != row) {

                            var destination_element = $(`.tile[data-position=${destination}]`)[0];
                            if(destination_element) {
                                if(!$(destination_element).children().length > 0) {
                                    delete valid_moves[i];
                                }
                            }
                        } else { // pawns can't attack forward
                            
                            var destination_element = $(`.tile[data-position=${destination}]`)[0];
                            if($(destination_element).children().length > 0) {
                                delete valid_moves[i];
                            }
                        }
                    }

                    if(type !== "knight") {
                        if(valid_location(destination)) {
                            if(!path_is_open(position, destination)) {
                                delete valid_moves[i];
                            }
                        }
                    }

                } // end of for loop

                highlight_potential_moves(valid_moves);

                return valid_moves;
            }

            function evaluate_moves(position, type, team, move) {
                evaluate_valid_moves(position, type, team, move);
            }

            function clear_active_tiles() {
                const active_tiles = document.getElementsByClassName('active_tile');
                const potential_moves = document.getElementsByClassName('potential_destination');

                for(var i = 0; i < active_tiles.length; i++) {
                    $(`.tile`).removeClass(' active_tile');
                }

                for(var j = 0; j < potential_moves.length; j++) {
                    $(`.tile`).removeClass(' potential_destination');
                }
            }

            function toggle_tile(position) {
                clear_active_tiles();
                $(`.tile[data-position=${position}]`).addClass(' active_tile');
            }

            function toggle_player_turn() {
                if(gameplay.player_turn == 'white') {
                    gameplay.player_turn = 'black';
                } else {
                    gameplay.player_turn = 'white';
                }
            }

            function move_piece(destination, piece) {
                $(`.tile[data-position=${destination}]`).append(piece);
                clear_active_tiles();
                toggle_player_turn();
            }

            $(document).on('click', '.potential_destination', function() {
                const destination = $(this).data().position;
                const piece = $('.active_tile').children('span');

                move_piece(destination, piece);
            });

            $(document).on('click', '.tile', function() {
            
                const position = $(this).data().position;

                if($(this).children().length > 0) {

                    // contains piece
                    const { team, type, move } = $(this).children('span').data();
                    
                    if(team == gameplay.player_turn) {

                        toggle_tile(position);
                        evaluate_moves(position, type, team, move);
                    } else {

                        // not their turn
                        clear_active_tiles();
                    }
                } else {

                    // doesn't contain piece, do nothing
                }
            });

            $(document).ready(function() {
                load_board();
                load_pieces();
            });
        </script>
    </body>
</html>